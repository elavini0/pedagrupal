<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación Colectiva Grupal - Recrearte</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
/* Reset y configuración base */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: #333;
    background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
    min-height: 100vh;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    background: white;
    min-height: 100vh;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
}

/* Header */
.header {
    background: linear-gradient(135deg, #00bcd4 0%, #4caf50 25%, #ff9800 50%, #f44336 75%, #9c27b0 100%);
    padding: 20px;
    color: white;
    position: relative;
    overflow: hidden;
}

.header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
}

.header > * {
    position: relative;
    z-index: 2;
}

.logo-section {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
}

.logo-recrearte {
    display: flex;
    align-items: center;
    gap: 20px;
}

.logo-image {
    height: 60px;
    width: auto;
    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
}

.page-title {
    font-size: 24px;
    font-weight: 400;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    color: white;
}

.date-section {
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.date-section label {
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 10px;
}

.date-section input {
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    font-size: 14px;
}

.btn-clear {
    background: #dc3545;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-clear:hover {
    background: #c82333;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(220,53,69,0.3);
}

/* Progress Bar */
.progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(255,255,255,0.3);
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4caf50, #00bcd4);
    width: 8.33%;
    transition: width 0.3s ease;
    border-radius: 4px;
}

/* Main Content */
.main-content {
    display: flex;
    min-height: calc(100vh - 200px);
}

/* Sidebar */
.sidebar {
    width: 280px;
    background: #f8f9fa;
    border-right: 1px solid #e9ecef;
    position: relative;
}

.nav-toggle {
    display: none;
    padding: 15px;
    cursor: pointer;
    font-size: 20px;
    background: #007bff;
    color: white;
    text-align: center;
}

.nav-menu {
    list-style: none;
    padding: 20px 0;
}

.nav-menu li {
    margin: 0;
}

.nav-link {
    display: block;
    padding: 12px 20px;
    text-decoration: none;
    color: #495057;
    transition: all 0.3s ease;
    border-left: 4px solid transparent;
}

.nav-link:hover {
    background: #e9ecef;
    color: #007bff;
    border-left-color: #007bff;
}

.nav-link.active {
    background: #007bff;
    color: white;
    border-left-color: #0056b3;
}

/* Form Content */
.form-content {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
}

.form-section {
    display: none;
    animation: fadeIn 0.3s ease;
}

.form-section.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.form-section h3 {
    color: #007bff;
    margin-bottom: 25px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e9ecef;
    font-size: 24px;
}

.form-section h4 {
    color: #495057;
    margin: 20px 0 15px 0;
    font-size: 18px;
}

/* Form Groups */
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #495057;
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 12px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
}

.form-group input:required:invalid {
    border-color: #dc3545;
}

.form-group input:required:valid {
    border-color: #28a745;
}

/* Grid Layouts */
.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.form-group.full-width {
    grid-column: 1 / -1;
}

.vitales-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.antropometria-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

/* Radio Groups */
.radio-group {
    display: flex;
    gap: 20px;
    margin-top: 10px;
}

.radio-group label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: normal;
    cursor: pointer;
}

/* Table Styles */
.table-container {
    overflow-x: auto;
    margin: 20px 0;
}

#grupoFamiliarTable {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 15px;
}

#grupoFamiliarTable th,
#grupoFamiliarTable td {
    padding: 12px;
    text-align: left;
    border: 1px solid #e9ecef;
}

#grupoFamiliarTable th {
    background: #f8f9fa;
    font-weight: 600;
    color: #495057;
}

#grupoFamiliarTable input {
    width: 100%;
    padding: 8px;
    border: 1px solid #e9ecef;
    border-radius: 4px;
}

/* Buttons */
.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
}

.btn-primary {
    background: #007bff;
    color: white;
}

.btn-primary:hover {
    background: #0056b3;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,123,255,0.3);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #545b62;
    transform: translateY(-2px);
}

.btn-success {
    background: #28a745;
    color: white;
}

.btn-success:hover {
    background: #1e7e34;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(40,167,69,0.3);
}

.btn-add {
    background: #28a745;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
}

.btn-add:hover {
    background: #1e7e34;
}

.btn-remove {
    background: #dc3545;
    color: white;
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
}

.btn-remove:hover {
    background: #c82333;
}

/* Navigation Buttons */
.navigation-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid #e9ecef;
}

/* Examen Subsections */
.examen-subsection {
    margin-bottom: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #007bff;
}

/* Firma Section */
.firma-section {
    margin-top: 40px;
    text-align: right;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.firma {
    font-size: 16px;
    color: #495057;
    line-height: 1.4;
}

/* Responsive Design */
@media (max-width: 768px) {
    .main-content {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        position: relative;
    }
    
    .nav-toggle {
        display: block;
    }
    
    .nav-menu {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: #f8f9fa;
        z-index: 1000;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .nav-menu.show {
        display: block;
    }
    
    .form-content {
        padding: 20px;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .vitales-grid,
    .antropometria-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    }
    
    .navigation-buttons {
        flex-direction: column;
        gap: 10px;
    }
    
    .logo-section {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .page-title {
        font-size: 20px;
    }
}

@media (max-width: 480px) {
    .form-content {
        padding: 15px;
    }
    
    .header {
        padding: 15px;
    }
    
    .logo-text {
        font-size: 24px;
    }
    
    .page-title {
        font-size: 18px;
    }
    
    .table-container {
        font-size: 12px;
    }
    
    #grupoFamiliarTable th,
    #grupoFamiliarTable td {
        padding: 8px;
    }
}

/* Print Styles */
@media print {
    .sidebar,
    .navigation-buttons,
    .nav-toggle {
        display: none;
    }
    
    .main-content {
        flex-direction: column;
    }
    
    .form-content {
        padding: 0;
    }
    
    .form-section {
        display: block !important;
        page-break-inside: avoid;
        margin-bottom: 30px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo-recrearte">
                    <img src="logo_solo_sombra.png" alt="Logo Recrearte" class="logo-image" id="logoImage">
                    <h2 class="page-title">Evaluación Colectiva Grupal - Recrearte</h2>
                </div>
            </div>
            <div class="date-section">
                <label>Fecha: <input type="date" id="fecha" required></label>
                <button type="button" id="clearFormBtn" class="btn-clear">🗑️ Limpiar Formulario</button>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </header>

        <div class="main-content">
            <!-- Sidebar Navigation -->
            <nav class="sidebar" id="sidebar">
                <div class="nav-toggle" id="navToggle">☰</div>
                <ul class="nav-menu" id="navMenu">
                    <li><a href="#seccion1" class="nav-link active" data-section="1">Datos del Grupo</a></li>
                    <li><a href="#seccion2" class="nav-link" data-section="2">Dinámica Grupal</a></li>
                    <li><a href="#seccion3" class="nav-link" data-section="3">Comunicación Grupal</a></li>
                    <li><a href="#seccion4" class="nav-link" data-section="4">Aprendizaje Colectivo</a></li>
                    <li><a href="#seccion5" class="nav-link" data-section="5">Expresión y Creatividad</a></li>
                    <li><a href="#seccion6" class="nav-link" data-section="6">Clima Emocional</a></li>
                    <li><a href="#seccion7" class="nav-link" data-section="7">Adaptabilidad</a></li>
                    <li><a href="#seccion8" class="nav-link" data-section="8">Sugerencias</a></li>
                </ul>
            </nav>

            <!-- Form Content -->
            <main class="form-content">
                <form id="historiaClinicaForm">


                    
                    <!-- Sección 1: Datos del Grupo -->
                    <section class="form-section active" id="seccion1">
                        <h3>👥 Datos del Grupo</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="nombreGrupo">Nombre del Grupo/Taller *</label>
                                <input type="text" id="nombreGrupo" name="nombreGrupo" required>
                            </div>
                            <div class="form-group">
                                <label for="cantidadParticipantes">Cantidad de Participantes *</label>
                                <input type="number" id="cantidadParticipantes" name="cantidadParticipantes" required min="1">
                            </div>
                            <div class="form-group">
                                <label for="edadPromedio">Edad Promedio del Grupo</label>
                                <input type="number" id="edadPromedio" name="edadPromedio" min="1" max="100">
                            </div>
                            <div class="form-group">
                                <label for="docenteEvaluador">Docente Evaluador *</label>
                                <input type="text" id="docenteEvaluador" name="docenteEvaluador" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="tipoActividad">Tipo de Actividad/Taller</label>
                                <input type="text" id="tipoActividad" name="tipoActividad" placeholder="Ej: Taller de arte, Actividad recreativa, etc.">
                            </div>
                            <div class="form-group full-width">
                                <label for="observacionesGeneralesGrupo">Observaciones Generales del Grupo</label>
                                <textarea id="observacionesGeneralesGrupo" name="observacionesGeneralesGrupo" rows="3" placeholder="Características generales del grupo, composición, etc."></textarea>
                            </div>
                        </div>
                    </section>
                    <section class="form-section" id="seccion2">
                        <h3>👥 Dinámica Grupal General</h3>
                        <div class="form-group">
                            <label for="participacionGrupo">¿Cómo es la participación del grupo en las actividades propuestas?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="participacionGrupo" value="muy_activa"> 🔘 Muy activa</label>
                                <label><input type="radio" name="participacionGrupo" value="activa"> 🔘 Activa</label>
                                <label><input type="radio" name="participacionGrupo" value="irregular"> 🔘 Irregular</label>
                                <label><input type="radio" name="participacionGrupo" value="escasa"> 🔘 Escasa</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="vinculosGrupo">¿Se observan vínculos entre los integrantes del grupo?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="vinculosGrupo" value="fuertes"> Vínculos fuertes</label>
                                <label><input type="radio" name="vinculosGrupo" value="moderados"> Vínculos moderados</label>
                                <label><input type="radio" name="vinculosGrupo" value="debiles"> Vínculos débiles</label>
                                <label><input type="radio" name="vinculosGrupo" value="ausentes"> Sin vínculos observables</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="dinamicaPredominante">¿Predomina la colaboración, la competencia o la indiferencia?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="dinamicaPredominante" value="colaboracion"> Colaboración</label>
                                <label><input type="radio" name="dinamicaPredominante" value="competencia"> Competencia</label>
                                <label><input type="radio" name="dinamicaPredominante" value="indiferencia"> Indiferencia</label>
                                <label><input type="radio" name="dinamicaPredominante" value="mixta"> Mixta</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="observacionesDinamica">Observaciones adicionales sobre la dinámica grupal</label>
                            <textarea id="observacionesDinamica" name="observacionesDinamica" rows="3" placeholder="Detalles específicos sobre la dinámica del grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Sección 3: Comunicación Grupal -->
                    <section class="form-section" id="seccion3">
                        <h3>📣 Comunicación Grupal</h3>
                        <div class="form-group">
                            <label for="canalesComunicativos">¿Qué tipo de canales comunicativos predominan en el grupo?</label>
                            <div class="form-group">
                                <label><input type="checkbox" name="canal_verbal" value="1"> Verbal</label>
                                <label><input type="checkbox" name="canal_gestual" value="1"> Gestual</label>
                                <label><input type="checkbox" name="canal_pictografico" value="1"> Pictográfico</label>
                                <label><input type="checkbox" name="canal_asistido" value="1"> Asistido</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="comprensionConsignas">¿Se comprenden las consignas como colectivo?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="comprensionConsignas" value="siempre"> Siempre</label>
                                <label><input type="radio" name="comprensionConsignas" value="frecuentemente"> Frecuentemente</label>
                                <label><input type="radio" name="comprensionConsignas" value="a_veces"> A veces</label>
                                <label><input type="radio" name="comprensionConsignas" value="raramente"> Raramente</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mediadoresComunicacion">¿Hay personas que median o facilitan la comunicación entre sus pares?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="mediadoresComunicacion" value="si_varios"> Sí, varios integrantes</label>
                                <label><input type="radio" name="mediadoresComunicacion" value="si_algunos"> Sí, algunos integrantes</label>
                                <label><input type="radio" name="mediadoresComunicacion" value="si_uno"> Sí, un integrante</label>
                                <label><input type="radio" name="mediadoresComunicacion" value="no"> No se observa</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="observacionesComunicacionGrupal">Observaciones adicionales sobre comunicación grupal</label>
                            <textarea id="observacionesComunicacionGrupal" name="observacionesComunicacionGrupal" rows="3" placeholder="Detalles sobre patrones comunicativos del grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Sección 4: Procesos de Aprendizaje Colectivos -->
                    <section class="form-section" id="seccion4">
                        <h3>🧠 Procesos de Aprendizaje Colectivos</h3>
                        <div class="form-group">
                            <label for="contenidosIncorporados">¿Qué contenidos/conceptos se incorporaron de forma significativa?</label>
                            <textarea id="contenidosIncorporados" name="contenidosIncorporados" rows="3" placeholder="Describir los aprendizajes más relevantes del grupo..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="autonomiaAprendizaje">¿El grupo transita los procesos de aprendizaje con acompañamiento o de manera más autónoma?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="autonomiaAprendizaje" value="muy_autonomo"> Muy autónomo</label>
                                <label><input type="radio" name="autonomiaAprendizaje" value="autonomo"> Autónomo</label>
                                <label><input type="radio" name="autonomiaAprendizaje" value="acompanamiento_moderado"> Con acompañamiento moderado</label>
                                <label><input type="radio" name="autonomiaAprendizaje" value="acompanamiento_constante"> Requiere acompañamiento constante</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="interesesComunes">¿Se presentan intereses comunes que pueden ser aprovechados pedagógicamente?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="interesesComunes" value="muchos"> Muchos intereses comunes</label>
                                <label><input type="radio" name="interesesComunes" value="algunos"> Algunos intereses comunes</label>
                                <label><input type="radio" name="interesesComunes" value="pocos"> Pocos intereses comunes</label>
                                <label><input type="radio" name="interesesComunes" value="ninguno"> No se observan</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="detalleIntereses">Detalle de intereses comunes identificados</label>
                            <textarea id="detalleIntereses" name="detalleIntereses" rows="3" placeholder="Especificar qué intereses comunes se observaron..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="observacionesAprendizaje">Observaciones adicionales sobre procesos de aprendizaje</label>
                            <textarea id="observacionesAprendizaje" name="observacionesAprendizaje" rows="3" placeholder="Detalles sobre cómo aprende el grupo colectivamente..."></textarea>
                        </div>
                    </section>

                    <!-- Sección 5: Expresión y Creatividad Grupal -->
                    <section class="form-section" id="seccion5">
                        <h3>🎨 Expresión y Creatividad Grupal</h3>
                        <div class="form-group">
                            <label for="apropiacionExpresiva">¿El grupo se apropia de las actividades expresivas como medio de participación?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="apropiacionExpresiva" value="totalmente"> Totalmente</label>
                                <label><input type="radio" name="apropiacionExpresiva" value="mayormente"> Mayormente</label>
                                <label><input type="radio" name="apropiacionExpresiva" value="parcialmente"> Parcialmente</label>
                                <label><input type="radio" name="apropiacionExpresiva" value="poco"> Poco</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="formasCreativas">¿Qué formas creativas destacan?</label>
                            <div class="form-group">
                                <label><input type="checkbox" name="arte_plastico" value="1"> Arte plástico</label>
                                <label><input type="checkbox" name="teatro" value="1"> Teatro</label>
                                <label><input type="checkbox" name="musica" value="1"> Música</label>
                                <label><input type="checkbox" name="movimiento" value="1"> Movimiento</label>
                                <label><input type="checkbox" name="otras_formas" value="1"> Otras formas</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="respuestaImprovision">¿Cómo responden colectivamente ante propuestas abiertas o improvisadas?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="respuestaImprovision" value="muy_positiva"> Muy positivamente</label>
                                <label><input type="radio" name="respuestaImprovision" value="positiva"> Positivamente</label>
                                <label><input type="radio" name="respuestaImprovision" value="variable"> De manera variable</label>
                                <label><input type="radio" name="respuestaImprovision" value="resistencia"> Con resistencia</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="observacionesCreatividad">Observaciones adicionales sobre expresión y creatividad grupal</label>
                            <textarea id="observacionesCreatividad" name="observacionesCreatividad" rows="3" placeholder="Detalles sobre la expresión creativa del grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Sección 6: Clima Grupal y Emocional -->
                    <section class="form-section" id="seccion6">
                        <h3>⛅ Clima Grupal y Emocional</h3>
                        <div class="form-group">
                            <label for="disposicionInicio">¿Cómo es la disposición emocional grupal al comienzo de la jornada?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="disposicionInicio" value="muy_positiva"> Muy positiva</label>
                                <label><input type="radio" name="disposicionInicio" value="positiva"> Positiva</label>
                                <label><input type="radio" name="disposicionInicio" value="neutral"> Neutral</label>
                                <label><input type="radio" name="disposicionInicio" value="variable"> Variable</label>
                                <label><input type="radio" name="disposicionInicio" value="negativa"> Negativa</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="disposicionCierre">¿Cómo es la disposición emocional grupal al cierre de la jornada?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="disposicionCierre" value="muy_positiva"> Muy positiva</label>
                                <label><input type="radio" name="disposicionCierre" value="positiva"> Positiva</label>
                                <label><input type="radio" name="disposicionCierre" value="neutral"> Neutral</label>
                                <label><input type="radio" name="disposicionCierre" value="variable"> Variable</label>
                                <label><input type="radio" name="disposicionCierre" value="negativa"> Negativa</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="momentosEmocionales">¿Se detectan momentos de tensión o entusiasmo colectivo?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="momentosEmocionales" value="mas_entusiasmo"> Más entusiasmo que tensión</label>
                                <label><input type="radio" name="momentosEmocionales" value="equilibrado"> Equilibrado</label>
                                <label><input type="radio" name="momentosEmocionales" value="mas_tension"> Más tensión que entusiasmo</label>
                                <label><input type="radio" name="momentosEmocionales" value="estable"> Clima estable</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="estrategiasEmocionales">¿Qué estrategias se utilizan para canalizar emociones grupales?</label>
                            <textarea id="estrategiasEmocionales" name="estrategiasEmocionales" rows="3" placeholder="Describir las estrategias utilizadas para manejar el clima emocional..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="observacionesClima">Observaciones adicionales sobre el clima grupal</label>
                            <textarea id="observacionesClima" name="observacionesClima" rows="3" placeholder="Detalles sobre el ambiente emocional del grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Sección 7: Adaptabilidad y Respuesta a lo Inesperado -->
                    <section class="form-section" id="seccion7">
                        <h3>🔄 Adaptabilidad y Respuesta a lo Inesperado</h3>
                        <div class="form-group">
                            <label for="respuestaImprevistos">¿Cómo responde el grupo ante imprevistos?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="respuestaImprevistos" value="muy_flexible"> Muy flexible y adaptable</label>
                                <label><input type="radio" name="respuestaImprevistos" value="flexible"> Flexible</label>
                                <label><input type="radio" name="respuestaImprevistos" value="algo_rigido"> Algo rígido</label>
                                <label><input type="radio" name="respuestaImprevistos" value="muy_rigido"> Muy rígido</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="flexibilidadActividades">¿Muestran flexibilidad para cambiar de actividad o modalidad?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="flexibilidadActividades" value="siempre"> Siempre</label>
                                <label><input type="radio" name="flexibilidadActividades" value="frecuentemente"> Frecuentemente</label>
                                <label><input type="radio" name="flexibilidadActividades" value="a_veces"> A veces</label>
                                <label><input type="radio" name="flexibilidadActividades" value="raramente"> Raramente</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="reencuadre">¿Se requiere reencuadrar constantemente las propuestas para sostener el interés colectivo?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="reencuadre" value="nunca"> Nunca</label>
                                <label><input type="radio" name="reencuadre" value="ocasionalmente"> Ocasionalmente</label>
                                <label><input type="radio" name="reencuadre" value="frecuentemente"> Frecuentemente</label>
                                <label><input type="radio" name="reencuadre" value="constantemente"> Constantemente</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="observacionesAdaptabilidad">Observaciones adicionales sobre adaptabilidad del grupo</label>
                            <textarea id="observacionesAdaptabilidad" name="observacionesAdaptabilidad" rows="3" placeholder="Detalles sobre la capacidad de adaptación del grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Sección 8: Sugerencias y Oportunidades -->
                    <section class="form-section" id="seccion8">
                        <h3>🗣️ Sugerencias y Oportunidades</h3>
                        <div class="form-group">
                            <label for="fortalezasGrupo">Fortalezas del Grupo</label>
                            <textarea id="fortalezasGrupo" name="fortalezasGrupo" rows="4" placeholder="Describir las principales fortalezas observadas en el grupo..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="desafiosTrabajar">Desafíos a Trabajar</label>
                            <textarea id="desafiosTrabajar" name="desafiosTrabajar" rows="4" placeholder="Identificar los principales desafíos que presenta el grupo..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="recomendacionesPlanificacion">Recomendaciones para la Planificación Pedagógica</label>
                            <textarea id="recomendacionesPlanificacion" name="recomendacionesPlanificacion" rows="4" placeholder="Sugerencias específicas para futuras planificaciones con este grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Navigation Buttons -->
                    <div class="navigation-buttons">
                        <button type="button" id="prevBtn" class="btn btn-secondary">Anterior</button>
                        <button type="button" id="generatePdfBtn" class="btn btn-success">Generar PDF</button>
                        <button type="button" id="nextBtn" class="btn btn-primary">Siguiente</button>
                    </div>
                </form>
            </main>
        </div>
    </div>

    <script>
// Variables globales
let currentSection = 1;
const totalSections = 8;
let familiarRowCount = 1;

// Inicialización cuando se carga la página
document.addEventListener('DOMContentLoaded', function() {
    initializeForm();
    setupEventListeners();
    updateProgress();
    
    // Establecer fecha actual
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('fecha').value = today;
    
    // Cargar datos guardados si existen
    loadFormData();
});

// Configurar event listeners
function setupEventListeners() {
    // Navegación
    document.getElementById('prevBtn').addEventListener('click', previousSection);
    document.getElementById('nextBtn').addEventListener('click', nextSection);
    document.getElementById('generatePdfBtn').addEventListener('click', generatePDF);
    document.getElementById('clearFormBtn').addEventListener('click', clearForm);
    
    // Navegación por menú lateral
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const sectionNumber = parseInt(this.dataset.section);
            goToSection(sectionNumber);
        });
    });
    
    // Toggle menú móvil
    document.getElementById('navToggle').addEventListener('click', function() {
        const navMenu = document.getElementById('navMenu');
        navMenu.classList.toggle('show');
    });
    
    // Auto-guardado
    const formInputs = document.querySelectorAll('input, textarea, select');
    formInputs.forEach(input => {
        input.addEventListener('change', saveFormData);
        input.addEventListener('input', debounce(saveFormData, 1000));
    });
}

// Inicializar formulario
function initializeForm() {
    showSection(currentSection);
    updateNavigationButtons();
}

// Mostrar sección específica
function showSection(sectionNumber) {
    // Ocultar todas las secciones
    const sections = document.querySelectorAll('.form-section');
    sections.forEach(section => section.classList.remove('active'));
    
    // Mostrar sección actual
    const currentSectionElement = document.getElementById(`seccion${sectionNumber}`);
    if (currentSectionElement) {
        currentSectionElement.classList.add('active');
    }
    
    // Actualizar navegación lateral
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        link.classList.remove('active');
        if (parseInt(link.dataset.section) === sectionNumber) {
            link.classList.add('active');
        }
    });
    
    currentSection = sectionNumber;
    updateProgress();
    updateNavigationButtons();
    
    // Scroll al top
    document.querySelector('.form-content').scrollTop = 0;
}

// Ir a sección específica
function goToSection(sectionNumber) {
    if (sectionNumber >= 1 && sectionNumber <= totalSections) {
        showSection(sectionNumber);
    }
}

// Sección anterior
function previousSection() {
    if (currentSection > 1) {
        showSection(currentSection - 1);
    }
}

// Sección siguiente
function nextSection() {
    if (currentSection < totalSections) {
        showSection(currentSection + 1);
    }
}

// Actualizar botones de navegación
function updateNavigationButtons() {
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const generatePdfBtn = document.getElementById('generatePdfBtn');
    
    prevBtn.style.display = currentSection === 1 ? 'none' : 'inline-block';
    
    if (currentSection === totalSections) {
        nextBtn.style.display = 'none';
        generatePdfBtn.style.display = 'inline-block';
    } else {
        nextBtn.style.display = 'inline-block';
        generatePdfBtn.style.display = 'none';
    }
}

// Actualizar barra de progreso
function updateProgress() {
    const progressFill = document.getElementById('progressFill');
    const percentage = (currentSection / totalSections) * 100;
    progressFill.style.width = percentage + '%';
}

// Guardar datos del formulario en localStorage
function saveFormData() {
    const formData = new FormData(document.getElementById('historiaClinicaForm'));
    const data = {};
    
    for (let [key, value] of formData.entries()) {
        data[key] = value;
    }
    
    // Guardar también datos de radio buttons y checkboxes
    const radioButtons = document.querySelectorAll('input[type="radio"]:checked');
    radioButtons.forEach(radio => {
        data[radio.name] = radio.value;
    });
    
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
        data[checkbox.name] = checkbox.checked;
    });
    
    localStorage.setItem('evaluacionGrupalData', JSON.stringify(data));
}

// Cargar datos del formulario desde localStorage
function loadFormData() {
    const savedData = localStorage.getItem('evaluacionGrupalData');
    if (savedData) {
        const data = JSON.parse(savedData);
        
        for (let [key, value] of Object.entries(data)) {
            const field = document.querySelector(`[name="${key}"]`);
            if (field) {
                if (field.type === 'checkbox') {
                    field.checked = value;
                } else if (field.type === 'radio') {
                    if (field.value === value) {
                        field.checked = true;
                    }
                } else {
                    field.value = value;
                }
            }
        }
    }
}

// Generar PDF
function generatePDF() {
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Configurar fuente
        doc.setFont('helvetica');
        
        let yPosition = 30;
        const pageHeight = doc.internal.pageSize.height;
        const marginLeft = 20;
        const marginRight = 20;
        const pageWidth = doc.internal.pageSize.width - marginLeft - marginRight;
        
        // Variable para controlar el número de página
        let pageNumber = 1;
        
        // Función para agregar nueva página si es necesario
        function checkPageBreak(neededSpace = 20) {
            if (yPosition + neededSpace > pageHeight - 40) {
                // Agregar numeración a la página actual antes de cambiar
                addPageNumber();
                doc.addPage();
                pageNumber++;
                yPosition = 30;
                // No agregar header en páginas nuevas
            }
        }
        
        // Función para agregar numeración de página
        function addPageNumber() {
            doc.setFontSize(10);
            doc.setTextColor('#666666');
            doc.setFont('helvetica', 'normal');
            doc.text(`Página ${pageNumber}`, doc.internal.pageSize.width / 2, pageHeight - 20, { align: 'center' });
        }
        
        // Función para agregar header simple
        function addSimpleHeader() {
            // Logo centrado
            const logoImg = document.getElementById('logoImage');
            if (logoImg && logoImg.complete) {
                // Crear canvas para convertir imagen a base64
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = logoImg.naturalWidth;
                canvas.height = logoImg.naturalHeight;
                ctx.drawImage(logoImg, 0, 0);
                const logoDataUrl = canvas.toDataURL('image/png');
                
                // Agregar logo centrado al PDF
                const logoWidth = 50;
                const logoHeight = (logoImg.naturalHeight / logoImg.naturalWidth) * logoWidth;
                const logoX = (doc.internal.pageSize.width - logoWidth) / 2;
                doc.addImage(logoDataUrl, 'PNG', logoX, yPosition, logoWidth, logoHeight);
                
                yPosition += logoHeight + 15; // Espacio después del logo
            }
            
            // Título del documento centrado
            doc.setFontSize(18);
            doc.setTextColor('#007bff');
            doc.setFont('helvetica', 'bold');
            const titleText = 'EVALUACIÓN COLECTIVA GRUPAL - RECREARTE';
            const titleWidth = doc.getTextWidth(titleText);
            const titleX = (doc.internal.pageSize.width - titleWidth) / 2;
            doc.text(titleText, titleX, yPosition);
            yPosition += 20;
            
            // Fecha como item separado
            const fecha = document.getElementById('fecha').value;
            doc.setFontSize(12);
            doc.setTextColor('#000000');
            doc.setFont('helvetica', 'normal');
            doc.text(`Fecha: ${fecha}`, marginLeft, yPosition);
            yPosition += 15;
            
            // Línea separadora
            doc.setDrawColor('#e9ecef');
            doc.line(marginLeft, yPosition, pageWidth, yPosition);
            
            yPosition += 20; // Más espacio antes del contenido
        }
        
        // Función para agregar sección
        function addSection(title, content) {
            checkPageBreak(30);
            
            // Título de sección
            doc.setFontSize(13);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor('#007bff');
            doc.text(title, marginLeft, yPosition);
            yPosition += 15;
            
            // Contenido
            doc.setTextColor('#000000');
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            
            if (typeof content === 'object') {
                Object.entries(content).forEach(([key, value]) => {
                    if (value) {
                        checkPageBreak();
                        const text = `${key}: ${value}`;
                        const lines = doc.splitTextToSize(text, pageWidth);
                        lines.forEach(line => {
                            doc.text(line, marginLeft, yPosition);
                            yPosition += 5;
                        });
                    }
                });
            } else if (content) {
                const lines = doc.splitTextToSize(content, pageWidth);
                lines.forEach(line => {
                    checkPageBreak();
                    doc.text(line, marginLeft, yPosition);
                    yPosition += 5;
                });
            }
            
            yPosition += 8;
        }
        
        // Agregar header inicial
        addSimpleHeader();
        
        // Recopilar datos del formulario
        const formData = new FormData(document.getElementById('historiaClinicaForm'));
        const data = {};
        for (let [key, value] of formData.entries()) {
            data[key] = value;
        }
        
        // Agregar secciones al PDF
        addSection('DATOS DEL GRUPO', {
            'Nombre del Grupo/Taller': data.nombreGrupo,
            'Cantidad de Participantes': data.cantidadParticipantes,
            'Edad Promedio': data.edadPromedio,
            'Docente Evaluador': data.docenteEvaluador,
            'Tipo de Actividad': data.tipoActividad,
            'Observaciones Generales': data.observacionesGeneralesGrupo
        });
        
        addSection('DINÁMICA GRUPAL GENERAL', {
            'Participación del grupo': data.participacionGrupo,
            'Vínculos entre integrantes': data.vinculosGrupo,
            'Dinámica predominante': data.dinamicaPredominante,
            'Observaciones': data.observacionesDinamica
        });
        
        addSection('COMUNICACIÓN GRUPAL', {
            'Canal verbal': data.canal_verbal ? 'Sí' : 'No',
            'Canal gestual': data.canal_gestual ? 'Sí' : 'No',
            'Canal pictográfico': data.canal_pictografico ? 'Sí' : 'No',
            'Canal asistido': data.canal_asistido ? 'Sí' : 'No',
            'Comprensión de consignas': data.comprensionConsignas,
            'Mediadores de comunicación': data.mediadoresComunicacion,
            'Observaciones': data.observacionesComunicacionGrupal
        });
        
        addSection('PROCESOS DE APRENDIZAJE COLECTIVOS', {
            'Contenidos incorporados': data.contenidosIncorporados,
            'Autonomía de aprendizaje': data.autonomiaAprendizaje,
            'Intereses comunes': data.interesesComunes,
            'Detalle de intereses': data.detalleIntereses,
            'Observaciones': data.observacionesAprendizaje
        });
        
        addSection('EXPRESIÓN Y CREATIVIDAD GRUPAL', {
            'Apropiación expresiva': data.apropiacionExpresiva,
            'Arte plástico': data.arte_plastico ? 'Sí' : 'No',
            'Teatro': data.teatro ? 'Sí' : 'No',
            'Música': data.musica ? 'Sí' : 'No',
            'Movimiento': data.movimiento ? 'Sí' : 'No',
            'Otras formas': data.otras_formas ? 'Sí' : 'No',
            'Respuesta a improvisación': data.respuestaImprovision,
            'Observaciones': data.observacionesCreatividad
        });
        
        addSection('CLIMA GRUPAL Y EMOCIONAL', {
            'Disposición al inicio': data.disposicionInicio,
            'Disposición al cierre': data.disposicionCierre,
            'Momentos emocionales': data.momentosEmocionales,
            'Estrategias emocionales': data.estrategiasEmocionales,
            'Observaciones': data.observacionesClima
        });
        
        addSection('ADAPTABILIDAD Y RESPUESTA A LO INESPERADO', {
            'Respuesta a imprevistos': data.respuestaImprevistos,
            'Flexibilidad en actividades': data.flexibilidadActividades,
            'Necesidad de reencuadre': data.reencuadre,
            'Observaciones': data.observacionesAdaptabilidad
        });
        
        addSection('SUGERENCIAS Y OPORTUNIDADES', {
            'Fortalezas del grupo': data.fortalezasGrupo,
            'Desafíos a trabajar': data.desafiosTrabajar,
            'Recomendaciones para planificación': data.recomendacionesPlanificacion
        });
        
        // Firma
        checkPageBreak(30);
        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        doc.text('DOCENTE', pageWidth - 50, yPosition);
        
        // Leyenda al final
        checkPageBreak(40);
        yPosition += 30;
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor('#666666');
        const leyenda = 'RECREARTE - Centro Educativo Terapeutico - Funes - Santa Fe';
        const leyendaWidth = doc.getTextWidth(leyenda);
        const centeredX = (doc.internal.pageSize.width - leyendaWidth) / 2;
        doc.text(leyenda, centeredX, yPosition);
        
        // Agregar numeración a la última página
        addPageNumber();
        
        // Guardar PDF
        const nombreGrupo = data.nombreGrupo || 'Evaluacion_Grupal';
        const fechaFormateada = data.fecha || new Date().toISOString().split('T')[0];
        doc.save(`${nombreGrupo}_Evaluacion_Grupal_${fechaFormateada}.pdf`);
        
    } catch (error) {
        console.error('Error generando PDF:', error);
        alert('Error al generar el PDF. Por favor, intente nuevamente.');
    }
}

// Limpiar formulario
function clearForm() {
    if (confirm('¿Está seguro de que desea limpiar todo el formulario? Esta acción no se puede deshacer.')) {
        document.getElementById('historiaClinicaForm').reset();
        
        // Limpiar localStorage
        localStorage.removeItem('evaluacionGrupalData');
        
        // Establecer fecha actual
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('fecha').value = today;
        
        // Volver a la primera sección
        showSection(1);
        
        alert('Formulario limpiado correctamente. Puede comenzar una nueva evaluación grupal.');
    }
}

// Función debounce para optimizar auto-guardado
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}
    </script>
</body>
</html>

