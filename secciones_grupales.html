                    <!-- Secci√≥n 2: Din√°mica Grupal General -->
                    <section class="form-section" id="seccion2">
                        <h3>üë• Din√°mica Grupal General</h3>
                        <div class="form-group">
                            <label for="participacionGrupo">¬øC√≥mo es la participaci√≥n del grupo en las actividades propuestas?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="participacionGrupo" value="muy_activa"> üîò Muy activa</label>
                                <label><input type="radio" name="participacionGrupo" value="activa"> üîò Activa</label>
                                <label><input type="radio" name="participacionGrupo" value="irregular"> üîò Irregular</label>
                                <label><input type="radio" name="participacionGrupo" value="escasa"> üîò Escasa</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="vinculosGrupo">¬øSe observan v√≠nculos entre los integrantes del grupo?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="vinculosGrupo" value="fuertes"> V√≠nculos fuertes</label>
                                <label><input type="radio" name="vinculosGrupo" value="moderados"> V√≠nculos moderados</label>
                                <label><input type="radio" name="vinculosGrupo" value="debiles"> V√≠nculos d√©biles</label>
                                <label><input type="radio" name="vinculosGrupo" value="ausentes"> Sin v√≠nculos observables</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="dinamicaPredominante">¬øPredomina la colaboraci√≥n, la competencia o la indiferencia?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="dinamicaPredominante" value="colaboracion"> Colaboraci√≥n</label>
                                <label><input type="radio" name="dinamicaPredominante" value="competencia"> Competencia</label>
                                <label><input type="radio" name="dinamicaPredominante" value="indiferencia"> Indiferencia</label>
                                <label><input type="radio" name="dinamicaPredominante" value="mixta"> Mixta</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="observacionesDinamica">Observaciones adicionales sobre la din√°mica grupal</label>
                            <textarea id="observacionesDinamica" name="observacionesDinamica" rows="3" placeholder="Detalles espec√≠ficos sobre la din√°mica del grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Secci√≥n 3: Comunicaci√≥n Grupal -->
                    <section class="form-section" id="seccion3">
                        <h3>üì£ Comunicaci√≥n Grupal</h3>
                        <div class="form-group">
                            <label for="canalesComunicativos">¬øQu√© tipo de canales comunicativos predominan en el grupo?</label>
                            <div class="form-group">
                                <label><input type="checkbox" name="canal_verbal" value="1"> Verbal</label>
                                <label><input type="checkbox" name="canal_gestual" value="1"> Gestual</label>
                                <label><input type="checkbox" name="canal_pictografico" value="1"> Pictogr√°fico</label>
                                <label><input type="checkbox" name="canal_asistido" value="1"> Asistido</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="comprensionConsignas">¬øSe comprenden las consignas como colectivo?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="comprensionConsignas" value="siempre"> Siempre</label>
                                <label><input type="radio" name="comprensionConsignas" value="frecuentemente"> Frecuentemente</label>
                                <label><input type="radio" name="comprensionConsignas" value="a_veces"> A veces</label>
                                <label><input type="radio" name="comprensionConsignas" value="raramente"> Raramente</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mediadoresComunicacion">¬øHay personas que median o facilitan la comunicaci√≥n entre sus pares?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="mediadoresComunicacion" value="si_varios"> S√≠, varios integrantes</label>
                                <label><input type="radio" name="mediadoresComunicacion" value="si_algunos"> S√≠, algunos integrantes</label>
                                <label><input type="radio" name="mediadoresComunicacion" value="si_uno"> S√≠, un integrante</label>
                                <label><input type="radio" name="mediadoresComunicacion" value="no"> No se observa</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="observacionesComunicacionGrupal">Observaciones adicionales sobre comunicaci√≥n grupal</label>
                            <textarea id="observacionesComunicacionGrupal" name="observacionesComunicacionGrupal" rows="3" placeholder="Detalles sobre patrones comunicativos del grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Secci√≥n 4: Procesos de Aprendizaje Colectivos -->
                    <section class="form-section" id="seccion4">
                        <h3>üß† Procesos de Aprendizaje Colectivos</h3>
                        <div class="form-group">
                            <label for="contenidosIncorporados">¬øQu√© contenidos/conceptos se incorporaron de forma significativa?</label>
                            <textarea id="contenidosIncorporados" name="contenidosIncorporados" rows="3" placeholder="Describir los aprendizajes m√°s relevantes del grupo..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="autonomiaAprendizaje">¬øEl grupo transita los procesos de aprendizaje con acompa√±amiento o de manera m√°s aut√≥noma?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="autonomiaAprendizaje" value="muy_autonomo"> Muy aut√≥nomo</label>
                                <label><input type="radio" name="autonomiaAprendizaje" value="autonomo"> Aut√≥nomo</label>
                                <label><input type="radio" name="autonomiaAprendizaje" value="acompanamiento_moderado"> Con acompa√±amiento moderado</label>
                                <label><input type="radio" name="autonomiaAprendizaje" value="acompanamiento_constante"> Requiere acompa√±amiento constante</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="interesesComunes">¬øSe presentan intereses comunes que pueden ser aprovechados pedag√≥gicamente?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="interesesComunes" value="muchos"> Muchos intereses comunes</label>
                                <label><input type="radio" name="interesesComunes" value="algunos"> Algunos intereses comunes</label>
                                <label><input type="radio" name="interesesComunes" value="pocos"> Pocos intereses comunes</label>
                                <label><input type="radio" name="interesesComunes" value="ninguno"> No se observan</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="detalleIntereses">Detalle de intereses comunes identificados</label>
                            <textarea id="detalleIntereses" name="detalleIntereses" rows="3" placeholder="Especificar qu√© intereses comunes se observaron..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="observacionesAprendizaje">Observaciones adicionales sobre procesos de aprendizaje</label>
                            <textarea id="observacionesAprendizaje" name="observacionesAprendizaje" rows="3" placeholder="Detalles sobre c√≥mo aprende el grupo colectivamente..."></textarea>
                        </div>
                    </section>

                    <!-- Secci√≥n 5: Expresi√≥n y Creatividad Grupal -->
                    <section class="form-section" id="seccion5">
                        <h3>üé® Expresi√≥n y Creatividad Grupal</h3>
                        <div class="form-group">
                            <label for="apropiacionExpresiva">¬øEl grupo se apropia de las actividades expresivas como medio de participaci√≥n?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="apropiacionExpresiva" value="totalmente"> Totalmente</label>
                                <label><input type="radio" name="apropiacionExpresiva" value="mayormente"> Mayormente</label>
                                <label><input type="radio" name="apropiacionExpresiva" value="parcialmente"> Parcialmente</label>
                                <label><input type="radio" name="apropiacionExpresiva" value="poco"> Poco</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="formasCreativas">¬øQu√© formas creativas destacan?</label>
                            <div class="form-group">
                                <label><input type="checkbox" name="arte_plastico" value="1"> Arte pl√°stico</label>
                                <label><input type="checkbox" name="teatro" value="1"> Teatro</label>
                                <label><input type="checkbox" name="musica" value="1"> M√∫sica</label>
                                <label><input type="checkbox" name="movimiento" value="1"> Movimiento</label>
                                <label><input type="checkbox" name="otras_formas" value="1"> Otras formas</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="respuestaImprovision">¬øC√≥mo responden colectivamente ante propuestas abiertas o improvisadas?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="respuestaImprovision" value="muy_positiva"> Muy positivamente</label>
                                <label><input type="radio" name="respuestaImprovision" value="positiva"> Positivamente</label>
                                <label><input type="radio" name="respuestaImprovision" value="variable"> De manera variable</label>
                                <label><input type="radio" name="respuestaImprovision" value="resistencia"> Con resistencia</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="observacionesCreatividad">Observaciones adicionales sobre expresi√≥n y creatividad grupal</label>
                            <textarea id="observacionesCreatividad" name="observacionesCreatividad" rows="3" placeholder="Detalles sobre la expresi√≥n creativa del grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Secci√≥n 6: Clima Grupal y Emocional -->
                    <section class="form-section" id="seccion6">
                        <h3>‚õÖ Clima Grupal y Emocional</h3>
                        <div class="form-group">
                            <label for="disposicionInicio">¬øC√≥mo es la disposici√≥n emocional grupal al comienzo de la jornada?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="disposicionInicio" value="muy_positiva"> Muy positiva</label>
                                <label><input type="radio" name="disposicionInicio" value="positiva"> Positiva</label>
                                <label><input type="radio" name="disposicionInicio" value="neutral"> Neutral</label>
                                <label><input type="radio" name="disposicionInicio" value="variable"> Variable</label>
                                <label><input type="radio" name="disposicionInicio" value="negativa"> Negativa</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="disposicionCierre">¬øC√≥mo es la disposici√≥n emocional grupal al cierre de la jornada?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="disposicionCierre" value="muy_positiva"> Muy positiva</label>
                                <label><input type="radio" name="disposicionCierre" value="positiva"> Positiva</label>
                                <label><input type="radio" name="disposicionCierre" value="neutral"> Neutral</label>
                                <label><input type="radio" name="disposicionCierre" value="variable"> Variable</label>
                                <label><input type="radio" name="disposicionCierre" value="negativa"> Negativa</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="momentosEmocionales">¬øSe detectan momentos de tensi√≥n o entusiasmo colectivo?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="momentosEmocionales" value="mas_entusiasmo"> M√°s entusiasmo que tensi√≥n</label>
                                <label><input type="radio" name="momentosEmocionales" value="equilibrado"> Equilibrado</label>
                                <label><input type="radio" name="momentosEmocionales" value="mas_tension"> M√°s tensi√≥n que entusiasmo</label>
                                <label><input type="radio" name="momentosEmocionales" value="estable"> Clima estable</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="estrategiasEmocionales">¬øQu√© estrategias se utilizan para canalizar emociones grupales?</label>
                            <textarea id="estrategiasEmocionales" name="estrategiasEmocionales" rows="3" placeholder="Describir las estrategias utilizadas para manejar el clima emocional..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="observacionesClima">Observaciones adicionales sobre el clima grupal</label>
                            <textarea id="observacionesClima" name="observacionesClima" rows="3" placeholder="Detalles sobre el ambiente emocional del grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Secci√≥n 7: Adaptabilidad y Respuesta a lo Inesperado -->
                    <section class="form-section" id="seccion7">
                        <h3>üîÑ Adaptabilidad y Respuesta a lo Inesperado</h3>
                        <div class="form-group">
                            <label for="respuestaImprevistos">¬øC√≥mo responde el grupo ante imprevistos?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="respuestaImprevistos" value="muy_flexible"> Muy flexible y adaptable</label>
                                <label><input type="radio" name="respuestaImprevistos" value="flexible"> Flexible</label>
                                <label><input type="radio" name="respuestaImprevistos" value="algo_rigido"> Algo r√≠gido</label>
                                <label><input type="radio" name="respuestaImprevistos" value="muy_rigido"> Muy r√≠gido</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="flexibilidadActividades">¬øMuestran flexibilidad para cambiar de actividad o modalidad?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="flexibilidadActividades" value="siempre"> Siempre</label>
                                <label><input type="radio" name="flexibilidadActividades" value="frecuentemente"> Frecuentemente</label>
                                <label><input type="radio" name="flexibilidadActividades" value="a_veces"> A veces</label>
                                <label><input type="radio" name="flexibilidadActividades" value="raramente"> Raramente</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="reencuadre">¬øSe requiere reencuadrar constantemente las propuestas para sostener el inter√©s colectivo?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="reencuadre" value="nunca"> Nunca</label>
                                <label><input type="radio" name="reencuadre" value="ocasionalmente"> Ocasionalmente</label>
                                <label><input type="radio" name="reencuadre" value="frecuentemente"> Frecuentemente</label>
                                <label><input type="radio" name="reencuadre" value="constantemente"> Constantemente</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="observacionesAdaptabilidad">Observaciones adicionales sobre adaptabilidad del grupo</label>
                            <textarea id="observacionesAdaptabilidad" name="observacionesAdaptabilidad" rows="3" placeholder="Detalles sobre la capacidad de adaptaci√≥n del grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Secci√≥n 8: Sugerencias y Oportunidades -->
                    <section class="form-section" id="seccion8">
                        <h3>üó£Ô∏è Sugerencias y Oportunidades</h3>
                        <div class="form-group">
                            <label for="fortalezasGrupo">Fortalezas del Grupo</label>
                            <textarea id="fortalezasGrupo" name="fortalezasGrupo" rows="4" placeholder="Describir las principales fortalezas observadas en el grupo..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="desafiosTrabajar">Desaf√≠os a Trabajar</label>
                            <textarea id="desafiosTrabajar" name="desafiosTrabajar" rows="4" placeholder="Identificar los principales desaf√≠os que presenta el grupo..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="recomendacionesPlanificacion">Recomendaciones para la Planificaci√≥n Pedag√≥gica</label>
                            <textarea id="recomendacionesPlanificacion" name="recomendacionesPlanificacion" rows="4" placeholder="Sugerencias espec√≠ficas para futuras planificaciones con este grupo..."></textarea>
                        </div>
                    </section>

                    <!-- Navigation Buttons -->
                    <div class="navigation-buttons">
                        <button type="button" id="prevBtn" class="btn btn-secondary">Anterior</button>
                        <button type="button" id="generatePdfBtn" class="btn btn-success">Generar PDF</button>
                        <button type="button" id="nextBtn" class="btn btn-primary">Siguiente</button>
                    </div>
                </form>
            </main>
        </div>
    </div>

    <script>
// Variables globales
let currentSection = 1;
const totalSections = 8;
let familiarRowCount = 1;

// Inicializaci√≥n cuando se carga la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    initializeForm();
    setupEventListeners();
    updateProgress();
    
    // Establecer fecha actual
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('fecha').value = today;
    
    // Cargar datos guardados si existen
    loadFormData();
});

// Configurar event listeners
function setupEventListeners() {
    // Navegaci√≥n
    document.getElementById('prevBtn').addEventListener('click', previousSection);
    document.getElementById('nextBtn').addEventListener('click', nextSection);
    document.getElementById('generatePdfBtn').addEventListener('click', generatePDF);
    document.getElementById('clearFormBtn').addEventListener('click', clearForm);
    
    // Navegaci√≥n por men√∫ lateral
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const sectionNumber = parseInt(this.dataset.section);
            goToSection(sectionNumber);
        });
    });
    
    // Toggle men√∫ m√≥vil
    document.getElementById('navToggle').addEventListener('click', function() {
        const navMenu = document.getElementById('navMenu');
        navMenu.classList.toggle('show');
    });
    
    // Auto-guardado
    const formInputs = document.querySelectorAll('input, textarea, select');
    formInputs.forEach(input => {
        input.addEventListener('change', saveFormData);
        input.addEventListener('input', debounce(saveFormData, 1000));
    });
}

// Inicializar formulario
function initializeForm() {
    showSection(currentSection);
    updateNavigationButtons();
}

// Mostrar secci√≥n espec√≠fica
function showSection(sectionNumber) {
    // Ocultar todas las secciones
    const sections = document.querySelectorAll('.form-section');
    sections.forEach(section => section.classList.remove('active'));
    
    // Mostrar secci√≥n actual
    const currentSectionElement = document.getElementById(`seccion${sectionNumber}`);
    if (currentSectionElement) {
        currentSectionElement.classList.add('active');
    }
    
    // Actualizar navegaci√≥n lateral
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        link.classList.remove('active');
        if (parseInt(link.dataset.section) === sectionNumber) {
            link.classList.add('active');
        }
    });
    
    currentSection = sectionNumber;
    updateProgress();
    updateNavigationButtons();
    
    // Scroll al top
    document.querySelector('.form-content').scrollTop = 0;
}

// Ir a secci√≥n espec√≠fica
function goToSection(sectionNumber) {
    if (sectionNumber >= 1 && sectionNumber <= totalSections) {
        showSection(sectionNumber);
    }
}

// Secci√≥n anterior
function previousSection() {
    if (currentSection > 1) {
        showSection(currentSection - 1);
    }
}

// Secci√≥n siguiente
function nextSection() {
    if (currentSection < totalSections) {
        showSection(currentSection + 1);
    }
}

// Actualizar botones de navegaci√≥n
function updateNavigationButtons() {
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const generatePdfBtn = document.getElementById('generatePdfBtn');
    
    prevBtn.style.display = currentSection === 1 ? 'none' : 'inline-block';
    
    if (currentSection === totalSections) {
        nextBtn.style.display = 'none';
        generatePdfBtn.style.display = 'inline-block';
    } else {
        nextBtn.style.display = 'inline-block';
        generatePdfBtn.style.display = 'none';
    }
}

// Actualizar barra de progreso
function updateProgress() {
    const progressFill = document.getElementById('progressFill');
    const percentage = (currentSection / totalSections) * 100;
    progressFill.style.width = percentage + '%';
}

// Guardar datos del formulario en localStorage
function saveFormData() {
    const formData = new FormData(document.getElementById('historiaClinicaForm'));
    const data = {};
    
    for (let [key, value] of formData.entries()) {
        data[key] = value;
    }
    
    // Guardar tambi√©n datos de radio buttons y checkboxes
    const radioButtons = document.querySelectorAll('input[type="radio"]:checked');
    radioButtons.forEach(radio => {
        data[radio.name] = radio.value;
    });
    
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
        data[checkbox.name] = checkbox.checked;
    });
    
    localStorage.setItem('evaluacionGrupalData', JSON.stringify(data));
}

// Cargar datos del formulario desde localStorage
function loadFormData() {
    const savedData = localStorage.getItem('evaluacionGrupalData');
    if (savedData) {
        const data = JSON.parse(savedData);
        
        for (let [key, value] of Object.entries(data)) {
            const field = document.querySelector(`[name="${key}"]`);
            if (field) {
                if (field.type === 'checkbox') {
                    field.checked = value;
                } else if (field.type === 'radio') {
                    if (field.value === value) {
                        field.checked = true;
                    }
                } else {
                    field.value = value;
                }
            }
        }
    }
}

// Generar PDF
function generatePDF() {
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Configurar fuente
        doc.setFont('helvetica');
        
        let yPosition = 30;
        const pageHeight = doc.internal.pageSize.height;
        const marginLeft = 20;
        const marginRight = 20;
        const pageWidth = doc.internal.pageSize.width - marginLeft - marginRight;
        
        // Variable para controlar el n√∫mero de p√°gina
        let pageNumber = 1;
        
        // Funci√≥n para agregar nueva p√°gina si es necesario
        function checkPageBreak(neededSpace = 20) {
            if (yPosition + neededSpace > pageHeight - 40) {
                // Agregar numeraci√≥n a la p√°gina actual antes de cambiar
                addPageNumber();
                doc.addPage();
                pageNumber++;
                yPosition = 30;
                // No agregar header en p√°ginas nuevas
            }
        }
        
        // Funci√≥n para agregar numeraci√≥n de p√°gina
        function addPageNumber() {
            doc.setFontSize(10);
            doc.setTextColor('#666666');
            doc.setFont('helvetica', 'normal');
            doc.text(`P√°gina ${pageNumber}`, doc.internal.pageSize.width / 2, pageHeight - 20, { align: 'center' });
        }
        
        // Funci√≥n para agregar header simple
        function addSimpleHeader() {
            // Logo centrado
            const logoImg = document.getElementById('logoImage');
            if (logoImg && logoImg.complete) {
                // Crear canvas para convertir imagen a base64
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = logoImg.naturalWidth;
                canvas.height = logoImg.naturalHeight;
                ctx.drawImage(logoImg, 0, 0);
                const logoDataUrl = canvas.toDataURL('image/png');
                
                // Agregar logo centrado al PDF
                const logoWidth = 50;
                const logoHeight = (logoImg.naturalHeight / logoImg.naturalWidth) * logoWidth;
                const logoX = (doc.internal.pageSize.width - logoWidth) / 2;
                doc.addImage(logoDataUrl, 'PNG', logoX, yPosition, logoWidth, logoHeight);
                
                yPosition += logoHeight + 15; // Espacio despu√©s del logo
            }
            
            // T√≠tulo del documento centrado
            doc.setFontSize(18);
            doc.setTextColor('#007bff');
            doc.setFont('helvetica', 'bold');
            const titleText = 'EVALUACI√ìN COLECTIVA GRUPAL - RECREARTE';
            const titleWidth = doc.getTextWidth(titleText);
            const titleX = (doc.internal.pageSize.width - titleWidth) / 2;
            doc.text(titleText, titleX, yPosition);
            yPosition += 20;
            
            // Fecha como item separado
            const fecha = document.getElementById('fecha').value;
            doc.setFontSize(12);
            doc.setTextColor('#000000');
            doc.setFont('helvetica', 'normal');
            doc.text(`Fecha: ${fecha}`, marginLeft, yPosition);
            yPosition += 15;
            
            // L√≠nea separadora
            doc.setDrawColor('#e9ecef');
            doc.line(marginLeft, yPosition, pageWidth, yPosition);
            
            yPosition += 20; // M√°s espacio antes del contenido
        }
        
        // Funci√≥n para agregar secci√≥n
        function addSection(title, content) {
            checkPageBreak(30);
            
            // T√≠tulo de secci√≥n
            doc.setFontSize(13);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor('#007bff');
            doc.text(title, marginLeft, yPosition);
            yPosition += 15;
            
            // Contenido
            doc.setTextColor('#000000');
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            
            if (typeof content === 'object') {
                Object.entries(content).forEach(([key, value]) => {
                    if (value) {
                        checkPageBreak();
                        const text = `${key}: ${value}`;
                        const lines = doc.splitTextToSize(text, pageWidth);
                        lines.forEach(line => {
                            doc.text(line, marginLeft, yPosition);
                            yPosition += 5;
                        });
                    }
                });
            } else if (content) {
                const lines = doc.splitTextToSize(content, pageWidth);
                lines.forEach(line => {
                    checkPageBreak();
                    doc.text(line, marginLeft, yPosition);
                    yPosition += 5;
                });
            }
            
            yPosition += 8;
        }
        
        // Agregar header inicial
        addSimpleHeader();
        
        // Recopilar datos del formulario
        const formData = new FormData(document.getElementById('historiaClinicaForm'));
        const data = {};
        for (let [key, value] of formData.entries()) {
            data[key] = value;
        }
        
        // Agregar secciones al PDF
        addSection('DATOS DEL GRUPO', {
            'Nombre del Grupo/Taller': data.nombreGrupo,
            'Cantidad de Participantes': data.cantidadParticipantes,
            'Edad Promedio': data.edadPromedio,
            'Docente Evaluador': data.docenteEvaluador,
            'Tipo de Actividad': data.tipoActividad,
            'Observaciones Generales': data.observacionesGeneralesGrupo
        });
        
        addSection('DIN√ÅMICA GRUPAL GENERAL', {
            'Participaci√≥n del grupo': data.participacionGrupo,
            'V√≠nculos entre integrantes': data.vinculosGrupo,
            'Din√°mica predominante': data.dinamicaPredominante,
            'Observaciones': data.observacionesDinamica
        });
        
        addSection('COMUNICACI√ìN GRUPAL', {
            'Canal verbal': data.canal_verbal ? 'S√≠' : 'No',
            'Canal gestual': data.canal_gestual ? 'S√≠' : 'No',
            'Canal pictogr√°fico': data.canal_pictografico ? 'S√≠' : 'No',
            'Canal asistido': data.canal_asistido ? 'S√≠' : 'No',
            'Comprensi√≥n de consignas': data.comprensionConsignas,
            'Mediadores de comunicaci√≥n': data.mediadoresComunicacion,
            'Observaciones': data.observacionesComunicacionGrupal
        });
        
        addSection('PROCESOS DE APRENDIZAJE COLECTIVOS', {
            'Contenidos incorporados': data.contenidosIncorporados,
            'Autonom√≠a de aprendizaje': data.autonomiaAprendizaje,
            'Intereses comunes': data.interesesComunes,
            'Detalle de intereses': data.detalleIntereses,
            'Observaciones': data.observacionesAprendizaje
        });
        
        addSection('EXPRESI√ìN Y CREATIVIDAD GRUPAL', {
            'Apropiaci√≥n expresiva': data.apropiacionExpresiva,
            'Arte pl√°stico': data.arte_plastico ? 'S√≠' : 'No',
            'Teatro': data.teatro ? 'S√≠' : 'No',
            'M√∫sica': data.musica ? 'S√≠' : 'No',
            'Movimiento': data.movimiento ? 'S√≠' : 'No',
            'Otras formas': data.otras_formas ? 'S√≠' : 'No',
            'Respuesta a improvisaci√≥n': data.respuestaImprovision,
            'Observaciones': data.observacionesCreatividad
        });
        
        addSection('CLIMA GRUPAL Y EMOCIONAL', {
            'Disposici√≥n al inicio': data.disposicionInicio,
            'Disposici√≥n al cierre': data.disposicionCierre,
            'Momentos emocionales': data.momentosEmocionales,
            'Estrategias emocionales': data.estrategiasEmocionales,
            'Observaciones': data.observacionesClima
        });
        
        addSection('ADAPTABILIDAD Y RESPUESTA A LO INESPERADO', {
            'Respuesta a imprevistos': data.respuestaImprevistos,
            'Flexibilidad en actividades': data.flexibilidadActividades,
            'Necesidad de reencuadre': data.reencuadre,
            'Observaciones': data.observacionesAdaptabilidad
        });
        
        addSection('SUGERENCIAS Y OPORTUNIDADES', {
            'Fortalezas del grupo': data.fortalezasGrupo,
            'Desaf√≠os a trabajar': data.desafiosTrabajar,
            'Recomendaciones para planificaci√≥n': data.recomendacionesPlanificacion
        });
        
        // Firma
        checkPageBreak(30);
        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        doc.text('DOCENTE', pageWidth - 50, yPosition);
        
        // Leyenda al final
        checkPageBreak(40);
        yPosition += 30;
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor('#666666');
        const leyenda = 'RECREARTE - Centro Educativo Terapeutico - Funes - Santa Fe';
        const leyendaWidth = doc.getTextWidth(leyenda);
        const centeredX = (doc.internal.pageSize.width - leyendaWidth) / 2;
        doc.text(leyenda, centeredX, yPosition);
        
        // Agregar numeraci√≥n a la √∫ltima p√°gina
        addPageNumber();
        
        // Guardar PDF
        const nombreGrupo = data.nombreGrupo || 'Evaluacion_Grupal';
        const fechaFormateada = data.fecha || new Date().toISOString().split('T')[0];
        doc.save(`${nombreGrupo}_Evaluacion_Grupal_${fechaFormateada}.pdf`);
        
    } catch (error) {
        console.error('Error generando PDF:', error);
        alert('Error al generar el PDF. Por favor, intente nuevamente.');
    }
}

// Limpiar formulario
function clearForm() {
    if (confirm('¬øEst√° seguro de que desea limpiar todo el formulario? Esta acci√≥n no se puede deshacer.')) {
        document.getElementById('historiaClinicaForm').reset();
        
        // Limpiar localStorage
        localStorage.removeItem('evaluacionGrupalData');
        
        // Establecer fecha actual
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('fecha').value = today;
        
        // Volver a la primera secci√≥n
        showSection(1);
        
        alert('Formulario limpiado correctamente. Puede comenzar una nueva evaluaci√≥n grupal.');
    }
}

// Funci√≥n debounce para optimizar auto-guardado
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}
    </script>
</body>
</html>

